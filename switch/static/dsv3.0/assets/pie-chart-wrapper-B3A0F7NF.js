import{r as pt,g as dt,a as ot,j as at}from"./index-C2PWchud.js";import"./transform-C4D8YA0C.js";import{o as ft}from"./ordinal-CG2fZEFB.js";import{B as mt}from"./base-element-5lxvCIHt.js";import{u as gt}from"./utils-mixin-D5aAiqNi.js";import{c as S}from"./constant-BhYcI2Bl.js";import{p as yt}from"./path-BevWroqt.js";import{s as Y,i as vt}from"./value-_r9_x9JY.js";import{m as lt}from"./mouse-zJOo7xoE.js";import{C as xt}from"./chart-mixin-ykJDgLsu.js";import{C as Ct}from"./chart-mixin-styles-css-ChS978uy.js";import{w as wt}from"./datasource-mixin-DMQBE4lo.js";import"./array-UnU61Zeg.js";import"./calendar-element-C00wmKBV.js";import"./select-element-GuC7mP6J.js";import"./InputMixin-CGm-oGk-.js";function St(t){var r=[];for(var a in t)r.push({key:a,value:t[a]});return r}var ht=Math.abs,C=Math.atan2,$=Math.cos,At=Math.max,rt=Math.min,P=Math.sin,B=Math.sqrt,R=1e-12,I=Math.PI,Q=I/2,K=2*I;function Rt(t){return t>1?0:t<-1?I:Math.acos(t)}function ut(t){return t>=1?Q:t<=-1?-Q:Math.asin(t)}function Tt(t){return t.innerRadius}function bt(t){return t.outerRadius}function Mt(t){return t.startAngle}function jt(t){return t.endAngle}function Dt(t){return t&&t.padAngle}function Ot(t,r,a,l,u,f,d,e){var n=a-t,s=l-r,v=d-u,h=e-f,o=h*n-v*s;if(!(o*o<R))return o=(v*(r-f)-h*(t-u))/o,[t+o*n,r+o*s]}function F(t,r,a,l,u,f,d){var e=t-a,n=r-l,s=(d?f:-f)/B(e*e+n*n),v=s*n,h=-s*e,o=t+v,g=r+h,m=a+v,T=l+h,p=(o+m)/2,b=(g+T)/2,w=m-o,x=T-g,y=w*w+x*x,M=u-f,A=o*T-m*g,E=(x<0?-1:1)*B(At(0,M*M*y-A*A)),k=(A*x-w*E)/y,j=(-A*w-x*E)/y,D=(A*x+w*E)/y,O=(-A*w+x*E)/y,i=k-p,c=j-b,G=D-p,N=O-b;return i*i+c*c>G*G+N*N&&(k=D,j=O),{cx:k,cy:j,x01:-v,y01:-h,x11:k*(u/M-1),y11:j*(u/M-1)}}function J(){var t=Tt,r=bt,a=S(0),l=null,u=Mt,f=jt,d=Dt,e=null;function n(){var s,v,h=+t.apply(this,arguments),o=+r.apply(this,arguments),g=u.apply(this,arguments)-Q,m=f.apply(this,arguments)-Q,T=ht(m-g),p=m>g;if(e||(e=s=yt()),o<h&&(v=o,o=h,h=v),!(o>R))e.moveTo(0,0);else if(T>K-R)e.moveTo(o*$(g),o*P(g)),e.arc(0,0,o,g,m,!p),h>R&&(e.moveTo(h*$(m),h*P(m)),e.arc(0,0,h,m,g,p));else{var b=g,w=m,x=g,y=m,M=T,A=T,E=d.apply(this,arguments)/2,k=E>R&&(l?+l.apply(this,arguments):B(h*h+o*o)),j=rt(ht(o-h)/2,+a.apply(this,arguments)),D=j,O=j,i,c;if(k>R){var G=ut(k/h*P(E)),N=ut(k/o*P(E));(M-=G*2)>R?(G*=p?1:-1,x+=G,y-=G):(M=0,x=y=(g+m)/2),(A-=N*2)>R?(N*=p?1:-1,b+=N,w-=N):(A=0,b=w=(g+m)/2)}var H=o*$(b),L=o*P(b),q=h*$(y),W=h*P(y);if(j>R){var z=o*$(w),U=o*P(w),X=h*$(x),Z=h*P(x),V;if(T<I&&(V=Ot(H,L,X,Z,z,U,q,W))){var _=H-V[0],tt=L-V[1],et=z-V[0],st=U-V[1],it=1/P(Rt((_*et+tt*st)/(B(_*_+tt*tt)*B(et*et+st*st)))/2),nt=B(V[0]*V[0]+V[1]*V[1]);D=rt(j,(h-nt)/(it-1)),O=rt(j,(o-nt)/(it+1))}}A>R?O>R?(i=F(X,Z,H,L,o,O,p),c=F(z,U,q,W,o,O,p),e.moveTo(i.cx+i.x01,i.cy+i.y01),O<j?e.arc(i.cx,i.cy,O,C(i.y01,i.x01),C(c.y01,c.x01),!p):(e.arc(i.cx,i.cy,O,C(i.y01,i.x01),C(i.y11,i.x11),!p),e.arc(0,0,o,C(i.cy+i.y11,i.cx+i.x11),C(c.cy+c.y11,c.cx+c.x11),!p),e.arc(c.cx,c.cy,O,C(c.y11,c.x11),C(c.y01,c.x01),!p))):(e.moveTo(H,L),e.arc(0,0,o,b,w,!p)):e.moveTo(H,L),!(h>R)||!(M>R)?e.lineTo(q,W):D>R?(i=F(q,W,z,U,h,-D,p),c=F(H,L,X,Z,h,-D,p),e.lineTo(i.cx+i.x01,i.cy+i.y01),D<j?e.arc(i.cx,i.cy,D,C(i.y01,i.x01),C(c.y01,c.x01),!p):(e.arc(i.cx,i.cy,D,C(i.y01,i.x01),C(i.y11,i.x11),!p),e.arc(0,0,h,C(i.cy+i.y11,i.cx+i.x11),C(c.cy+c.y11,c.cx+c.x11),p),e.arc(c.cx,c.cy,D,C(c.y11,c.x11),C(c.y01,c.x01),!p))):e.arc(0,0,h,y,x,p)}if(e.closePath(),s)return e=null,s+""||null}return n.centroid=function(){var s=(+t.apply(this,arguments)+ +r.apply(this,arguments))/2,v=(+u.apply(this,arguments)+ +f.apply(this,arguments))/2-I/2;return[$(v)*s,P(v)*s]},n.innerRadius=function(s){return arguments.length?(t=typeof s=="function"?s:S(+s),n):t},n.outerRadius=function(s){return arguments.length?(r=typeof s=="function"?s:S(+s),n):r},n.cornerRadius=function(s){return arguments.length?(a=typeof s=="function"?s:S(+s),n):a},n.padRadius=function(s){return arguments.length?(l=s==null?null:typeof s=="function"?s:S(+s),n):l},n.startAngle=function(s){return arguments.length?(u=typeof s=="function"?s:S(+s),n):u},n.endAngle=function(s){return arguments.length?(f=typeof s=="function"?s:S(+s),n):f},n.padAngle=function(s){return arguments.length?(d=typeof s=="function"?s:S(+s),n):d},n.context=function(s){return arguments.length?(e=s??null,n):e},n}function Pt(t,r){return r<t?-1:r>t?1:r>=t?0:NaN}function Vt(t){return t}function Et(){var t=Vt,r=Pt,a=null,l=S(0),u=S(K),f=S(0);function d(e){var n,s=e.length,v,h,o=0,g=new Array(s),m=new Array(s),T=+l.apply(this,arguments),p=Math.min(K,Math.max(-K,u.apply(this,arguments)-T)),b,w=Math.min(Math.abs(p)/s,f.apply(this,arguments)),x=w*(p<0?-1:1),y;for(n=0;n<s;++n)(y=m[g[n]=n]=+t(e[n],n,e))>0&&(o+=y);for(r!=null?g.sort(function(M,A){return r(m[M],m[A])}):a!=null&&g.sort(function(M,A){return a(e[M],e[A])}),n=0,h=o?(p-s*x)/o:0;n<s;++n,T=b)v=g[n],y=m[v],b=T+(y>0?y*h:0)+x,m[v]={data:e[v],index:n,value:y,startAngle:T,endAngle:b,padAngle:w};return m}return d.value=function(e){return arguments.length?(t=typeof e=="function"?e:S(+e),d):t},d.sortValues=function(e){return arguments.length?(r=e,a=null,d):r},d.sort=function(e){return arguments.length?(a=e,r=null,d):a},d.startAngle=function(e){return arguments.length?(l=typeof e=="function"?e:S(+e),d):l},d.endAngle=function(e){return arguments.length?(u=typeof e=="function"?e:S(+e),d):u},d.padAngle=function(e){return arguments.length?(f=typeof e=="function"?e:S(+e),d):f},d}const kt=class extends gt(mt){static get properties(){return{dataToPlot:Object,processedData:Object,colors:Array,details:Object,colorScale:Object,chart:Object,svg:Object,svgCanvas:Object,sections:Object,width:Number,height:Number,margin:Object,radius:Number,tooltip:Object,rows:{type:Array},e:{type:Object},cols:{type:Array}}}constructor(){super(),this.dataToPlot={},this.colors=[],this.legend=[],this.rows=[],this.cols=[]}updated(t){(t.has("e")||t.has("cols"))&&(this.chart=this.shadowRoot.querySelector("#chart"),this.cols=this.chartSummaryCols?this.chartSummaryCols:this.cols,this.rows=this.chartSummaryRows?this.chartSummaryRows:this.rows,this.details=this.chartSummaryDetails?this.chartSummaryDetails:this.e.details,this.createChartData(),this.initChart(),new ResizeObserver(()=>this.drawChart()).observe(this.chart),this.animateChart())}updated(t){super.updated(t),t.forEach((r,a)=>{a==="rows"&&r&&r.length>0&&(this.createChartData(),this.updateChart(),this.drawChart())})}initChart(){this.createSVGs(),this.createScales(),this.updateChart(),this.createToolTip(),this.drawChart()}animateChart(){const t=r=>{const a=vt({startAngle:0,endAngle:0},r);return l=>J().innerRadius(0).outerRadius(this.radius)(a(l))};this.sections.attr("d",J().innerRadius(0).outerRadius(0)).transition().duration(1e3).attrTween("d",t)}calculateDimensions(){const t=l=>{const u=Math.max(document.documentElement.clientHeight,window.innerHeight||0);return l*u/100},r=this.chart.getBoundingClientRect().width,a=t(this.details.height?this.details.height:50);this.margin={top:50,right:5,bottom:25,left:5},this.width=r,this.height=a,this.radius=Math.min(this.width,this.height)/2}createChartData(){const t=this.details.columns_to_plot,a=this.rows[0];t.forEach(l=>{const u=this.cols.findIndex(f=>f.label.toLowerCase()===l.toLowerCase());Object.assign(this.dataToPlot,{[l]:a[u]})}),this.colors=t.map((l,u,f)=>this.randomColorGenerator(f.length,u)),console.log(this.dataToPlot),this.legend=t.map((l,u)=>{const f=this.colors[u];return{label:this.toTitleCase(l),color:f}})}createSVGs(){this.calculateDimensions(),this.svg=Y(this.chart).append("svg").attr("preserveAspectRatio","xMinYMin meet"),this.svgCanvas=this.svg.append("g").attr("transform",`translate(${this.width/2},${this.height/2})`)}createScales(){this.colorScale=ft()}updateChart(){this.colorScale.domain(this.dataToPlot).range(this.colors),this.pie=Et().value(t=>t.value),this.processedData=this.pie(St(this.dataToPlot)),this.sections=this.svgCanvas.selectAll("path").data(this.processedData),this.createSections()}createSections(){this.sections&&this.sections.remove();const t=(a,l,u)=>{this.tooltip.transition().duration(200).style("opacity",.9),Y(u[l]).style("opacity","0.7"),this.tooltip.html(`Label: ${this.toTitleCase(a.data.key)}<br/>Value: ${a.data.value}`).style("left",lt(this)[0]+50+"px").style("top",lt(this)[1]+"px")},r=(a,l)=>{this.tooltip.transition().duration(500).style("opacity",0),Y(l[a]).style("opacity","1")};this.sections=this.svgCanvas.selectAll("section").data(this.processedData).join("path").attr("fill",a=>this.colorScale(a.data.key)).attr("stroke","black").style("stroke-width","0.2px").attr("d",J().innerRadius(0).outerRadius(this.radius)).attr("fill",a=>this.colorScale(a.data.key)).attr("stroke","black").attr("cursor","pointer").on("mouseover",(a,l,u)=>t(a,l,u)).on("mouseout",(a,l,u)=>r(l,u))}createToolTip(){this.tooltip=Y(this.chart).append("div").attr("class","tooltip").style("opacity",0)}drawChart(){this.calculateDimensions(),this.responsiveSVG(),this.responsiveSVGCanvas(),this.responsiveSections()}responsiveSVG(){this.svg.attr("width",this.width),this.svg.attr("height",this.height)}responsiveSVGCanvas(){this.svgCanvas.attr("transform",`translate(${this.width/2}, ${this.height/2})`)}responsiveSections(){this.sections.attr("d",J().innerRadius(0).outerRadius(this.radius))}toTitleCase(t){if(!t)return"";t=t.toString(),t=t.toLowerCase().split(" ");let r=[];for(let a=0;a<t.length;a++)r[a]=t[a].substr(0,1).toUpperCase()+t[a].substr(1);return r.join(" ")}dscDataName(){return this.e.defaultValue}init(t,r){super.init(t,r);var a=this;a.loader=this.loadData()}static get is(){return"pie-chart"}};class ct extends xt(kt){static get styles(){return[pt(dt),Ct]}}customElements.define(ct.is,ct);const Gt=({element:t})=>{const r=ot.useRef(null);return ot.useEffect(()=>{console.log("Element:",t),r.current&&t&&(r.current.e=t)},[t]),at.jsx("div",{children:t?at.jsx("pie-chart",{id:"pie-chart",ref:r}):at.jsx("p",{children:"Loading data..."})})},Zt=wt(Gt);export{Zt as default};
