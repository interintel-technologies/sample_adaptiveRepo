const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/confirm-box-C321X7eO.js","assets/index-C2PWchud.js","assets/index-BVKXu6s1.css","assets/SectionTemplate-Drou2IoY.js","assets/banner-element-D-9VUv9l.js","assets/status-dialog-CiHXLQud.js"])))=>i.map(i=>d[i]);
var T=a=>{throw TypeError(a)};var W=(a,s,r)=>s.has(a)||T("Cannot "+r);var f=(a,s,r)=>s.has(a)?T("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(a):s.set(a,r);var p=(a,s,r)=>(W(a,s,"access private method"),r);import"./SectionTemplate-Drou2IoY.js";import{Z as R,$ as q,i as B,h as U,a0 as E}from"./index-C2PWchud.js";/**
@license
Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const F=a=>s=>class extends s{connectedCallback(){super.connectedCallback&&super.connectedCallback(),this._storeUnsubscribe=a.subscribe(()=>this.stateChanged(a.getState())),this.stateChanged(a.getState())}disconnectedCallback(){this._storeUnsubscribe(),super.disconnectedCallback&&super.disconnectedCallback()}stateChanged(r){}},V={method:"POST",url:"https://nikobizz.staging.interintel.co/openapi/pos/cart-items/add-to-cart/"},J={method:"DELETE",url:""},L={method:"GET",url:"https://nikobizz.staging.interintel.co/openapi/pos/cart-items/"},M={cart:[],wishlist:[],isCartLoading:!1,isWishlistLoading:!1},A=R({name:"eCommerce",initialState:M,reducers:{setCart:(a,s)=>{console.log("action.payload ",s),a.cart=s.payload},setWishlist:(a,s)=>{a.wishlist=s.payload},setIsCartLoading:(a,s)=>{a.isCartLoading=s.payload},setIsWishlistLoading:(a,s)=>{a.isWishlistLoading=s.payload}}}),l=q({reducer:{ecCommerce:A.reducer}}),{setCart:I,setWishlist:S,setIsCartLoading:Q,setIsWishlistLoading:z}=A.actions,j=B`
    .top-banner-stack {
        position: fixed;
        top: 0;
        width: 100vw;
        z-index:10 !important;
    }
    .bottom-banner-stack {
        position: fixed;
        bottom: 0;
        width: 100vw;
        z-index:10 !important;
    }
`,v="banner-event",y="status-dialog-event",K="confirm-box-action-clicked-event";var u,w,O,k,x;class g extends U{static get styles(){return{PopUpStyles:j}}static addEventListeners(){p(this,u,k).call(this),window.addEventListener(v,s=>p(this,u,w).call(this,s)),window.addEventListener(y,s=>p(this,u,O).call(this,s))}static removeEventListeners(){window.removeEventListener(v,s=>p(this,u,w).call(this,s)),window.removeEventListener(y,s=>p(this,u,O).call(this,s))}static pushBanner(s){window.dispatchEvent(new CustomEvent(v,{bubbles:!0,composed:!0,detail:s}))}static showStatusDialog(s,r){window.dispatchEvent(new CustomEvent(y,{bubbles:!0,composed:!0,detail:{type:s,title:r}}))}static showConfirmBox(s,r,_,m){E(()=>import("./confirm-box-C321X7eO.js"),__vite__mapDeps([0,1,2,3])).then(()=>{const d=document.createElement("confirm-box");d.setAttribute("title",JSON.stringify(s)),d.setAttribute("subtitle",JSON.stringify(r)),d.setAttribute("actions",JSON.stringify(_)),d.addEventListener(K,t=>m(t.detail)),document.body.append(d)})}}u=new WeakSet,w=function(s){E(()=>import("./banner-element-D-9VUv9l.js"),__vite__mapDeps([4,1,2]));const r=s.detail,_=document.querySelector(".top-banner-stack"),m=document.querySelector(".bottom-banner-stack"),d=document.createElement("banner-element");switch(d.setAttribute("banner",JSON.stringify(r)),r.position){case"top":_.appendChild(d);break;case"bottom":m.appendChild(d);break;default:_.appendChild(d);break}},O=function(s){const r=document.body.querySelector("status-dialog"),_=s.detail.title,m=s.detail.type,d={title:_,type:m};r?r.setAttribute("status",JSON.stringify(d)):E(()=>import("./status-dialog-CiHXLQud.js"),__vite__mapDeps([5,1,2])).then(()=>{const t=document.createElement("status-dialog");document.body.append(t),t.setAttribute("status",JSON.stringify(d))})},k=function(){p(this,u,x).call(this)},x=function(){const s=document.createElement("div");s.className="top-banner-stack",s.setAttribute("style","position: fixed; top: 0; width: 100vw; z-index:10;");const r=document.createElement("div");r.className="bottom-banner-stack",r.setAttribute("style","position: fixed; bottom: 0; width: 100vw; z-index:10;"),document.body.append(s,r)},f(g,u);const Z=a=>{var s,b,P,m;return m=class extends F(l)(a){constructor(){super();f(this,s);this.cart=[],this.wishlist=[]}static get properties(){return{cart:Array,wishlist:Array,isCartLoading:Boolean,isWishlistLoading:Boolean}}stateChanged(t){console.log("state is ",t),t.eCommerce&&(this.cart=t.ecCommerce.cart,this.wishlist=t.ecCommerce.wishlist,this.isCartLoading=t.ecCommerce.isCartLoading,this.isWishlistLoading=t.ecCommerce.isWishlistLoading)}fetchCart(){this._setLoadingState("cart",!0),window.isPOS?this.posAPIRequest(L,null).then(t=>{this.cart=t.cart_items.map(e=>({...e,quantity:parseInt(e.quantity),price:parseFloat(e.price)})),this._setLoadingState("cart",!1)}).catch(()=>{this._setLoadingState("cart",!1)}):(this._setLoadingState("cart",!1),this.cart=[...this.rows.map(t=>Object.fromEntries(t.map((e,i)=>{if(this.cols[i].label==="quantity")return["quantity",parseInt(e)];if(this.cols[i].label==="stockQuantity")return["stockQuantity",parseInt(e)];if(this.cols[i].label==="price")return["price",parseFloat(e)];if(this.cols[i].label==="total")return["total",parseFloat(e)];if(this.cols[i].label==="sub total")return["subtotal",parseFloat(e)];if(this.cols[i].label==="discount")return["discount",parseFloat(e)];if(this.cols[i].label==="product id"){const n=this.cols.findIndex(c=>c.label==="product_item_variant_id");return n?[this.cols[i].label,e+"|"+t[n]]:[this.cols[i].label,e]}return[this.cols[i].label,e]})))],console.log("this cart is ",this.cart),this.loadCartToState(this.cart))}loadCartToState(t){console.log("eCommerceStore ",t,l.dispatch(I(t))),l.dispatch(I(t))}addProductToCart(t){if(this.isItemInCart(t.id))this.updateCartItemQuantity(t.id,this.getCartItemQuantity(t.id)+1,"product");else{const e=this._parseCartItem(t),i=this._extractProductIdAnVariant(t.id)[0],n=this._extractProductIdAnVariant(t.id)[1],c={product_item_id:i,product_item_variant_id:n,quantity:1};p(this,s,b).call(this,"ADD TO CART",c,"cart").then(h=>{l.dispatch(I([...this.cart,e]))})}}updateCartItemQuantity(t,e,i){const n=this._findIndexOfItemInList(t,this.cart),c=this.cart[n];if(e>0){const h={...c,quantity:e},o=[...this.cart];o.splice(n,1,h);let C;if(i==="product"){const[D,N]=this._extractProductIdAnVariant(t);C={[i+"_item_id"]:D,product_item_variant_id:N,quantity:e}}else C={[i+"_item_id"]:t,quantity:e};p(this,s,b).call(this,window.isPOS?"UPDATE CART":"ADD TO CART",C,"cart",o).then(()=>{l.dispatch(I(o))})}else this.removeItemFromCart(t,i)}removeItemFromCart(t,e){const i=this._findIndexOfItemInList(t,this.cart),n=[...this.cart];n.splice(i,1);let c;if(e==="product"){const h=this._extractProductIdAnVariant(t)[0],o=this._extractProductIdAnVariant(t)[1];c={[e+"_item_id"]:h,product_item_variant_id:o}}else c={[e+"_item_id"]:t};p(this,s,b).call(this,"DELETE CART ITEM",c,"cart").then(()=>{l.dispatch(I(n))})}getCartItemQuantity(t){return this.isItemInCart(t)?this.getCartItem(t).quantity:0}isItemInCart(t){return!!this.getCartItem(t)}getCartItem(t){const e=this._findIndexOfItemInList(t,this.cart);return this.cart[e]}getCartCount(){return this.cart.reduce((t,e)=>t=t+e.quantity,0)}_onCartUpdatedEventListener(t){const e=t.detail;this.cart=[...e]}_parseCartItem(t){return{...t,price:typeof t.price=="object"?t.price.current:t.price,image:t.image?t.image:t.images?t.images[0]:null,quantity:t.quantity?t.quantity:1,stockQuantity:t.stockQuantity,isNotSynced:!0}}isCartItemSynced(t){return!this.getCartItem(t).isNotSynced}fetchWishlist(){this.isWishlistLoading=!0,this.loader.then(()=>{this.isWishlistLoading=!1,this.wishlist=[...this.rows.map(t=>Object.fromEntries(t.map((e,i)=>this.cols[i].label==="quantity"?["quantity",parseInt(e)]:[this.cols[i].label,e])))],this.loadWishlistToState(this.wishlist)}).catch(()=>{this.isWishlistLoading=!1})}loadWishlistToState(t){l.dispatch(S(t))}addProductToWishlist(t){const e=this._findIndexOfItemInList(t.id,this.wishlist),i=this._parseWishlistItem(t);if(e>=0){const n=[...this.wishlist];n.splice(e,1,i),this.wishlist=[...n]}else Object.assign(i,{addedOn:new Date().getTime()}),this.wishlist=[...this.wishlist,i];l.dispatch(S(this.wishlist))}getWishlistItem(t){const e=this._findIndexOfItemInList(t,this.wishlist);return this.cart[e]}removeItemFromWishlist(t){const e=this._findIndexOfItemInList(t,this.wishlist),i=[...this.wishlist];i.splice(e,1),this.wishlist=[...i],l.dispatch(S(wishlist))}isItemInWishlist(t){return this._findIndexOfItemInList(t,this.wishlist)>=0}_onWishlistUpdatedEventListener(t){const e=t.detail;this.wishlist=[...e]}_parseWishlistItem(t){return{id:t.id,name:t.name,price:typeof t.price=="object"?t.price.current:t.price,image:t.image?t.image:t.images[0],stockQuantity:10,addedOn:new Date().getTime(),quantity:1}}_findIndexOfItemInList(t,e){return this._extractProductIdAnVariant(t)[0],this._extractProductIdAnVariant(t)[1],e.findIndex(i=>i.id===t||i["product id"]===t)}_getPropertyByType(t){switch(t){case"cart":return this.cart;case"wishlist":return this.wishlist;default:new Error("Unknown type "+t).break}}_extractProductIdAnVariant(t){return t.toString().split("|")}formatToKenyaShillings(t){return new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(t)}triggerServiceCall(){const t=new CustomEvent("service-call",{detail:{},bubbles:!0,composed:!0});this.dispatchEvent(t)}_setLoadingState(t,e){switch(t){case"cart":l.dispatch(Q(e));break;case"wishlist":l.dispatch(z(e));break;default:console.error(t+" is not a valid type.");break}}saveOrder(){const t=new Date,e={year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0},i=t.toLocaleString("en-US",e),n=JSON.parse(localStorage.getItem("savedOrders"))||{};n[i]=this.cart,localStorage.setItem("savedOrders",JSON.stringify(n)),this.cart=[],l.dispatch(I(this.cart))}viewSavedOrders(){const t=JSON.parse(localStorage.getItem("savedOrders"));this.savedOrders=t}removeFromSavedOrders(t){for(const e in this.savedOrders)e==t&&(delete this.savedOrders[e],localStorage.setItem("savedOrders",JSON.stringify(this.savedOrders)),this.requestUpdate())}loadSavedOrder(t){for(const e in this.savedOrders)e==t&&l.dispatch(I(this.savedOrders[e]))}},s=new WeakSet,b=function(t,e,i,n){return this._setLoadingState(i,!0),new Promise((c,h)=>{if(window.isPOS)p(this,s,P).call(this,t,e,c,h,i);else{const o=new CustomEvent("submit-cart",{detail:{service:t,params:e,Cart:n},bubbles:!0,composed:!0});this.dispatchEvent(o),c()}})},P=function(t,e,i,n,c){let h;switch(t){case"ADD TO CART":h=V,e={...e,chid:3,cart_type:"POS"};break;case"UPDATE CART":h=STATIC;break;case"DELETE CART ITEM":h=J;case"CART_ITEMS":h=L;break}this.posAPIRequest(h,e).then(o=>{this._setLoadingState(c,!1),o.isSuccessful?(i(o),g.pushBanner({message:o.response,type:"success",position:"top",duration:3e3,cancelable:!1})):(n(o),g.pushBanner({message:o.response,type:"danger",position:"top",duration:3e3,cancelable:!1}))}).catch(o=>{this._setLoadingState(c,!1),n(o),g.pushBanner({message:o,type:"danger",position:"top",duration:3e3,cancelable:!1})})},m};export{K as C,Z as E,l as e,I as s};
